<main>
  <h1>Enter your code below</h1>
  <input type="text" keyboardType="numeric" onValueChange={handleValueChange(this.value)} class="codeInput" />
</main>

<script>
import { render } from '@neft/core'
import WebSocket from '@neft/websocket'
import renderFromCode from '~/src/lib/render-from-code'
import NativeApp from '.'

export const handleValueChange = (code) => {
  const numbers = code.replace(/ /g, '')
  if (numbers.length === 6) {
    connectToServer(numbers)
  }
}

export const connectToServer = (code) => {
  const ws = new WebSocket('wss://editor.neft.io/socket')
  ws.onopen = () => {
    ws.send(JSON.stringify({ listen: code }))
  }

  ws.onmessage = (event) => {
    renderFromCode(event.data)
  }

  ws.onclose = () => {
    render(NativeApp)
  }
}
</script>

<style>
main {
  layout: 'column'
  alignment: 'center'
  fillHeight: true

  h1 #text {
    alignment: 'center'
    font.pixelSize: 20
  }
}

.codeInput {
  width: 200

  @Rectangle {
    width: parent.width
    height: 1
    color: 'green'
    anchors.bottom: parent.bottom
  }
}
</style>
